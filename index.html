<!DOCTYPE html>
<html>
<head>
	<title></title>
	 <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="mdb.min.css">
   <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
</head>
<style type="text/css">
	.test-leave-to, .test-enter{
		transform: translateX(-100px);
		opacity: 0;
	}
	.test-enter-active, .test-leave-active{
		transition: all .5s ease;
	}

	.tableRow-leave-to, .tableRow-enter{
		transform: translateY(-20px);
		opacity: 0;
	}
	.tableRow-enter-active, .tableRow-leave-active{
		transition: all .5s ease;
	}
</style>
<body>
<div class="container-fluid">
   <div class="row" id="app">
    <div class="col-md-3" style="padding: 3em">
		 <h4 class="display-4">NASA API</h4>

         <button class="btn blue-gradient" :disabled="!disableBtn" @click="apod" style="width: 9em;">APOD</button>
         <button class="btn blue-gradient" :disabled="disableBtn" @click="neo" style="width: 9em;">NEO</button>

         <a type="button" class="btn purple-gradient" href="https://github.com/dhuang0903/VueTest/archive/master.zip"><i class="fas fa-cloud-download-alt"></i> Download Source</a>

    </div>

     <div class="col-md-9">
            <div class="jumbotron playground">
                <div class="container-fluid">
                    <div class="row">

                      <!------APOD------->
                      <div class="col-md-12" v-cloak style="overflow: auto;" v-if="APOD">
                        <h3>APOD (Astronomy Picture of the Day)</h3>
                        <p>{{title}} -- <span class="badge badge-info animated bounceInDown" style="font-size: 1em">{{date}}</span></p>
                         <iframe v-if="type" :src="imageUrl" :title="imageTitle" width="700" height="350"></iframe>
                         <img v-else :src="imageUrl" :title="imageTitle" width=90%>
                       
                      </div>
                      <!--------NEO---------->
                      <div class="col-md-12" v-else>
                        <h3 class="">NEO (Near-earth Objects)</h3>
                  
                  	<transition name="test">
                        <div v-cloak v-if="numAstroids > 0 && showDetail">
                          <p class="mt-3 badge rounded animated fadeInLeft"  style="font-size: 1.1em;background: #69901D;padding:1em;">showing {{numAstroids}} items</p>
                          <p>{{largestObject.name}} has the largest diameter among these NEOs. It's about <span class="badge badge-info animated heartBeat" style="font-size: 1em">{{largestObject.diameter}}</span> feet.</p>
                        </div>
                    </transition>

                        <a href="#" @click="showDetail = !showDetail">Show/hide the summary</a>
                        <table class="table table-dark table-striped" style="width: 100%;overflow: auto">
                          <thead>
                            <th>#</th>
                            <th>Name</th>
                            <th>Close Approach Date</th>
                            <th>Estimated Diameter (ft)</th>
                            <th>Remove</th>
                          </thead>
                      	<tbody is="transition-group" name="tableRow" v-cloak>
                            <tr v-cloak v-for="(a,index) in astroids" :key="a.neo_reference_id">
                              <td>{{index + 1}}</td>
                              <td>{{a.name}}</td>
                              <td  :style="getRowStyle(a)">{{getApproachDate(a)}}</td>
                              <td>
                                <ul>
                                  <li v-for="(value, key) in a.estimated_diameter.feet">
                                    {{key}}: {{value}}
                                  </li>
                                </ul>
                              </td>
                              <td>
                                <button @click="remove(index)" class="btn btn-warning animated fadeInRight">remove</button>
                              </td>
                            </tr>
                   		 </tbody>

                        </table>

                      </div>
                     
                    </div>
                </div>
                     
            </div>
            </div>

       </div>
  </div>
   <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
   <script type="text/javascript">
   		
	var vm = new Vue({
					el: "#app",
					data: {
						imageUrl: "",
						imageTitle: "",
						title: "",
						date: "",
						type: "",
						APOD: true,
						disableBtn:false,
						astroids: [],
						showDetail: true
					},
					computed: {
						numAstroids: function(){
						return this.astroids.length;
					},
						largestObject: function(){
							//get the objects that actually have diameter data
							var neosHavingData = this.astroids.filter(function(neo){
								return neo.estimated_diameter != null;
							});

							var simpleNeos = neosHavingData.map(function(neo){
								return {name:neo.name, diameter: Math.round(neo.estimated_diameter.feet.estimated_diameter_max)};
							});

							var sortedNoes = simpleNeos.sort(function(a,b){
								return a.diameter-b.diameter;
							});
							
							return sortedNoes[sortedNoes.length-1];
						}
					},
					created: function (){
						this.fetchAstroids();
					},
					methods: {
						fetchAstroids: function(){
							var apiKey = 'aYKdbEeryeBw5nhmse0NJP5rPt3tzSlVavBfLOFE';
							var url_apod = "https://api.nasa.gov/planetary/apod?api_key=" + apiKey;
							var url_neo = "https://api.nasa.gov/neo/rest/v1/neo/browse?api_key=" + apiKey;
							axios.get(url_apod)
							 .then(function(response){
							 	vm.imageUrl = response.data.url;
							 	vm.imageTitle = response.data.title;
							 	vm.title = response.data.title;
							 	vm.date = response.data.date;

							 	if(response.data.media_type == 'video')
							 		vm.type = true;
							 	else
							 		vm.type = false;
							 });

							 axios.get(url_neo)
							 .then(function(response2){
							 	vm.astroids = response2.data.near_earth_objects.slice(0,20);
							 });
						},

						getApproachDate: function(a){
							if(a.close_approach_data.length != 0)
								return a.close_approach_data[0].close_approach_date;
							else
								return 'N/A'
						},

						remove: function(index){
							this.astroids.splice(index,1);
			
						},

						apod: function(){
							vm.APOD = true;
							this.disableBtn = false;
						},
						neo: function(){
							vm.APOD = false;
							this.disableBtn = true;
						},

						getRowStyle: function(a){
							if (a.close_approach_data.length == 0) {
								return {
									color:'red',
									'font-weight':'bold'
									};
							}
						}

					}
				});
   </script>
</body>
</html>